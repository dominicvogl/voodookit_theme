!function(e){acf.pro={init:function(){var e=this;return acf.add_action("conditional_logic_show_field",function(t){e.conditional_logic_show_field(t)}),acf.add_action("conditional_logic_hide_field",function(t){e.conditional_logic_hide_field(t)}),acf.add_filter("is_field_ready_for_js",function(t,a){return e.is_field_ready_for_js(t,a)}),this},is_field_ready_for_js:function(e,t){return t.closest(".acf-row.clone").exists()&&(e=!1),t.closest(".acf-flexible-content > .clones").exists()&&(e=!1),e},conditional_logic_show_field:function(e){if(acf.is_sub_field(e)&&e.is("td")){var t=acf.get_field_key(e),a=e.closest(".acf-table"),i=a.find('> thead > tr > th[data-key="'+t+'"]'),l=a.find('> tbody > tr:not(.clone) > td[data-key="'+t+'"]');e.removeClass("appear-empty"),l.filter(".hidden-by-conditional-logic").addClass("appear-empty"),i.removeClass("hidden-by-conditional-logic"),this.render_table(a)}},conditional_logic_hide_field:function(e){if(acf.is_sub_field(e)&&e.is("td")){var t=acf.get_field_key(e),a=e.closest(".acf-table"),i=a.find('> thead > tr > th[data-key="'+t+'"]'),l=a.find('> tbody > tr:not(.clone) > td[data-key="'+t+'"]');e.addClass("appear-empty"),l.filter(".hidden-by-conditional-logic").length==l.length&&(l.removeClass("appear-empty"),i.addClass("hidden-by-conditional-logic")),this.render_table(a)}},render_table:function(t){if(!t.hasClass("row-layout")){var a=t.find("> thead > tr > th"),i=100,l=0;a.filter(".order").exists()&&(i=93),a.removeAttr("width"),a=a.not(".order, .remove, .hidden-by-conditional-logic"),a.filter("[data-width]").each(function(){if(l+1==a.length)return!1;l++;var t=parseInt(e(this).attr("data-width"));i-=t,e(this).attr("width",t+"%")}),a.not("[data-width]").each(function(){if(l+1==a.length)return!1;l++;var t=i/a.length;e(this).attr("width",t+"%")})}}}.init(),acf.fields.repeater={o:{},el:".acf-repeater",$field:null,$el:null,$clone:null,set:function(e){return this.$field=e,this.$el=e.find(this.el).first(),this.$clone=this.$el.find("> table > tbody > tr.clone"),this.o=acf.get_data(this.$el),this},count:function(){return this.$el.find("> table > tbody > tr").length-1},init:function(){var e=this.$field;1!=this.o.max&&this.$el.find("> table > tbody").unbind("sortable").sortable({items:"> tr",handle:"> td.order",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){acf.do_action("sortstart",t.item,t.placeholder)},stop:function(t,a){acf.do_action("sortstop",a.item,a.placeholder),acf.fields.repeater.set(e).render()}}),acf.pro.render_table(this.$el.find("> table")),this.$clone.find("[name]").attr("disabled","disabled"),this.render()},render:function(){this.$el.find("> table > tbody > tr").each(function(t){e(this).children("td.order").html(t+1)}),0==this.count()?this.$el.addClass("empty"):this.$el.removeClass("empty"),this.o.max>0&&this.count()>=this.o.max?(this.$el.addClass("disabled"),this.$el.find("> .acf-hl .acf-button").addClass("disabled")):(this.$el.removeClass("disabled"),this.$el.find("> .acf-hl .acf-button").removeClass("disabled"))},add:function(t){t=t||!1;var a=this.$field;if(this.o.max>0&&this.count()>=this.o.max)return alert(acf._e("repeater","max").replace("{max}",this.o.max)),!1;var i=acf.get_uniqid(),l=this.$clone.outerHTML(),l=l.replace(/(="[\w-\[\]]+?)(acfcloneindex)/g,"$1"+i),n=e(l);return n.removeClass("clone"),n.find("[name]").removeAttr("disabled"),t&&t.exists()||(t=this.$clone),t.before(n),this.$field.parents(".acf-row").trigger("mouseenter"),this.render(),acf.validation.remove_error(this.$field),acf.do_action("append",n),n},remove:function(e){var t=this.$field;return this.count()<=this.o.min?(alert(acf._e("repeater","min").replace("{min}",this.o.min)),!1):void acf.remove_tr(e,function(){t.closest(".acf-row").trigger("mouseenter"),acf.fields.repeater.set(t).render()})}},acf.add_action("ready append",function(t){acf.get_fields({type:"repeater"},t).each(function(){acf.fields.repeater.set(e(this)).init()})}),e(document).on("click",".acf-repeater .acf-repeater-add-row",function(t){t.preventDefault();var a=e(this),i=acf.get_field_wrap(a),l=!1;a.is(".acf-icon")&&(l=a.closest(".acf-row")),acf.fields.repeater.set(i).add(l),e(this).blur()}),e(document).on("click",".acf-repeater .acf-repeater-remove-row",function(t){t.preventDefault();var a=e(this),i=acf.get_field_wrap(a),l=a.closest(".acf-row");acf.fields.repeater.set(i).remove(l),e(this).blur()}),e(document).on("mouseenter",".acf-repeater .acf-row",function(t){var a=e(this).find("> td.remove .acf-repeater-add-row"),i=a.parent().height()/2+9;a.css("margin-top","-"+i+"px")}),acf.fields.flexible_content={o:{},el:".acf-flexible-content",$field:null,$el:null,$values:null,$clones:null,set:function(e){return this.$field=e,this.$el=e.find(this.el).first(),this.$values=this.$el.children(".values"),this.$clones=this.$el.children(".clones"),this.o=acf.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0,this},count:function(){return this.$values.children(".layout").length},init:function(){var t=this,a=this.$field;1!=this.o.max&&this.$values.unbind("sortable").sortable({items:"> .layout",handle:"> .acf-fc-layout-handle",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){acf.do_action("sortstart",t.item,t.placeholder)},stop:function(e,i){acf.do_action("sortstop",i.item,i.placeholder),t.set(a).render()}}),this.$values.find(".acf-table").each(function(){acf.pro.render_table(e(this))}),this.$clones.find("[name]").attr("disabled","disabled"),this.render()},render:function(){this.$values.children(".layout").each(function(t){e(this).find("> .acf-fc-layout-handle .fc-layout-order").html(t+1)}),0==this.count()?this.$el.addClass("empty"):this.$el.removeClass("empty"),this.o.max>0&&this.count()>=this.o.max?(this.$el.addClass("disabled"),this.$el.find("> .acf-hl .acf-button").addClass("disabled")):(this.$el.removeClass("disabled"),this.$el.find("> .acf-hl .acf-button").removeClass("disabled"))},validate_add:function(t){var a=!0;if(this.o.max>0&&this.count()>=this.o.max){var i=1==this.o.max?"layout":"layouts",l=acf._e("flexible_content","max");l=l.replace("{max}",this.o.max),l=l.replace("{identifier}",acf._e("flexible_content",i)),a=!1,alert(l)}var n=e(this.$el.children(".tmpl-popup").html()),c=n.find('[data-layout="'+t+'"]'),o=c.attr("data-max"),s=this.$values.children('.layout[data-layout="'+t+'"]').length;if(o=parseInt(o),o>0&&s>=o){var i=1==o?"layout":"layouts",l=acf._e("flexible_content","max_layout");l=l.replace("{max}",s),l=l.replace("{label}",'"'+c.text()+'"'),l=l.replace("{identifier}",acf._e("flexible_content",i)),a=!1,alert(l)}return a},validate_remove:function(t){if(this.o.min>0&&this.count()<=this.o.min){var a=1==this.o.min?"layout":"layouts",i=acf._e("flexible_content","min")+", "+acf._e("flexible_content","remove");return i=i.replace("{min}",this.o.min),i=i.replace("{identifier}",acf._e("flexible_content",a)),i=i.replace("{layout}",acf._e("flexible_content","layout")),confirm(i)}var l=e(this.$el.children(".tmpl-popup").html()),n=l.find('[data-layout="'+t+'"]'),c=n.attr("data-min"),o=this.$values.children('.layout[data-layout="'+t+'"]').length;if(c=parseInt(c),c>0&&c>=o){var a=1==c?"layout":"layouts",i=acf._e("flexible_content","min_layout")+", "+acf._e("flexible_content","remove");return i=i.replace("{min}",o),i=i.replace("{label}",'"'+n.text()+'"'),i=i.replace("{identifier}",acf._e("flexible_content",a)),i=i.replace("{layout}",acf._e("flexible_content","layout")),confirm(i)}return!0},add:function(t,a){if(this.validate_add(t)){var i=acf.get_uniqid(),l=this.$clones.children('.layout[data-layout="'+t+'"]').outerHTML(),l=l.replace(/(="[\w-\[\]]+?)(acfcloneindex)/g,"$1"+i),n=e(l);n.find("[name]").removeAttr("disabled"),this.$el.children(".no-value-message").hide(),a?a.before(n):this.$values.append(n),acf.do_action("append",n),this.render(),acf.validation.remove_error(this.$field)}},remove:function(e){if(this.validate_remove(e.attr("data-layout"))){var t=0,a=this.$el.children(".no-value-message");0==e.siblings(".layout").length&&(t=a.outerHeight()),acf.remove_el(e,function(){t>0&&a.show()},t)}},toggle:function(e){"closed"==e.attr("data-toggle")?(e.attr("data-toggle","open"),e.children(".acf-input-table").show()):(e.attr("data-toggle","closed"),e.children(".acf-input-table").hide()),this.sync()},sync:function(){var t="acf_collapsed_"+acf.get_data(this.$field,"key"),a=[];this.$values.children(".layout").each(function(t){"closed"==e(this).attr("data-toggle")&&a.push(t)}),acf.update_cookie(t,a.join("|"))},open_popup:function(t,a){var i=this;a=a||!1;var l=e(this.$el.children(".tmpl-popup").html());l.find("a").each(function(){var t=parseInt(e(this).attr("data-min")),a=parseInt(e(this).attr("data-max")),l=e(this).attr("data-layout"),n=e(this).text(),c=i.$values.children('.layout[data-layout="'+l+'"]').length,o=e(this).children(".status");if(a>0){var s=a-c,r=acf.l10n.flexible_content.available,d=1==s?"layout":"layouts",r=r.replace("{available}",s);r=r.replace("{max}",a),r=r.replace("{label}",'"'+n+'"'),r=r.replace("{identifier}",acf.l10n.flexible_content[d]),o.show().text(s).attr("title",r),0==s&&o.addClass("warning")}if(t>0){var f=t-c,r=acf.l10n.flexible_content.required,d=1==f?"layout":"layouts",r=r.replace("{required}",f);r=r.replace("{min}",t),r=r.replace("{label}",'"'+n+'"'),r=r.replace("{identifier}",acf.l10n.flexible_content[d]),f>0&&o.addClass("warning").show().text(f).attr("title",r)}}),t.after(l),a&&(l.addClass("within-layout"),l.closest(".layout").addClass("popup-open")),l.css({"margin-top":0-l.height()-t.outerHeight()-14,"margin-left":(t.outerWidth()-l.width())/2});var n=l.offset().top;30>n&&(l.css({"margin-top":15}),l.find(".bit").addClass("top")),l.children(".focus").trigger("focus")}},acf.add_action("ready append",function(t){acf.get_fields({type:"flexible_content"},t).each(function(){acf.fields.flexible_content.set(e(this)).init()})}),e(document).on("click",".acf-flexible-content .acf-fc-add",function(t){t.preventDefault();var a=e(this),i=acf.get_field_wrap(a),l=!1;e(this).attr("data-before")&&(l=!0),acf.fields.flexible_content.set(i).open_popup(a,l),e(this).blur()}),e(document).on("click",".acf-flexible-content .acf-fc-remove",function(t){t.preventDefault();var a=e(this),i=acf.get_field_wrap(a),l=a.closest(".layout");acf.fields.flexible_content.set(i).remove(l),e(this).blur()}),e(document).on("click",".acf-flexible-content .acf-fc-layout-handle",function(t){t.preventDefault();var a=e(this),i=acf.get_field_wrap(a),l=a.closest(".layout");acf.fields.flexible_content.set(i).toggle(l),e(this).blur()}),e(document).on("click",".acf-flexible-content .acf-fc-popup li a",function(t){t.preventDefault();var a=e(this),i=acf.get_field_wrap(a),l=a.closest(".acf-fc-popup");$layout=null,l.hasClass("within-layout")&&($layout=l.closest(".layout")),acf.fields.flexible_content.set(i).add(a.attr("data-layout"),$layout),e(this).blur()}),e(document).on("blur",".acf-flexible-content .acf-fc-popup .focus",function(t){var a=e(this).parent();a.closest(".layout").exists()&&a.closest(".layout").removeClass("popup-open"),setTimeout(function(){a.remove()},200)}),e(document).on("acf/validate_field",function(t,a){var i=e(a);if(i.hasClass("field_type-flexible_content")){var l=i.find(".acf-flexible-content:first");i.data("validation",!1),i.data("validation_message",!1),l.children(".values").children(".layout").exists()&&i.data("validation",!0);var n=parseInt(l.attr("data-min"));if(n>0&&l.children(".values").children(".layout").length<n){var c=1==n?"layout":"layouts",o=acf.l10n.flexible_content.min;o=o.replace("{min}",n),o=o.replace("{identifier}",acf.l10n.flexible_content[c]),i.data("validation",!1),i.data("validation_message",o)}var s=e(l.children(".tmpl-popup").html());s.find("a").each(function(){var t=parseInt(e(this).attr("data-min")),a=parseInt(e(this).attr("data-max")),n=e(this).attr("data-layout"),c=e(this).text(),o=l.children(".values").children('.layout[data-layout="'+n+'"]').length;if(t>o){var s=1==t?"layout":"layouts",r=acf.l10n.flexible_content.min_layout;r=r.replace("{min}",t),r=r.replace("{label}",'"'+c+'"'),r=r.replace("{identifier}",acf.l10n.flexible_content[s]),i.data("validation",!1),i.data("validation_message",r)}})}}),acf.fields.gallery={o:{},el:".acf-gallery",$field:null,$el:null,focus:function(e){return this.set(acf.get_closest_field(e))},set:function(e){return this.$field=e,this.$el=e.find(this.el).first(),this.o=acf.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0,this},get_attachment:function(e){e=e||"";var t=".acf-gallery-attachment";return"active"===e?t+=".active":e&&(t+='[data-id="'+e+'"]'),this.$el.find(t)},count:function(){return this.get_attachment().length},init:function(){this.$el.find(".acf-gallery-attachments").unbind("sortable").sortable({items:".acf-gallery-attachment",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){t.placeholder.html(t.item.html()),t.placeholder.removeAttr("style"),acf.do_action("sortstart",t.item,t.placeholder)},stop:function(e,t){acf.do_action("sortstop",t.item,t.placeholder)}}),this.$el.unbind("resizable").resizable({handles:"s",minHeight:200,stop:function(e,t){acf.update_user_setting("gallery_height",t.size.height)}}),this.render(),this.resize()},render:function(){var e=this.$el.find(".bulk-actions"),t=this.$el.find(".add-attachment");this.o.max>0&&this.count()>=this.o.max?t.addClass("disabled"):t.removeClass("disabled")},sort:function(t){if(t){var a=acf.prepare_for_ajax({action:"acf/fields/gallery/get_sort_order",field_key:acf.get_data(this.$field,"key"),post_id:acf.get("post_id"),ids:[],sort:t});this.get_attachment().each(function(){a.ids.push(e(this).attr("data-id"))});var i=e.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"get",cache:!1,data:a,context:this,success:this.sort_success})}},sort_success:function(e){if(e&&e.success){e.data.reverse();for(i in e.data){var t=e.data[i],a=this.get_attachment(t);this.$el.find(".acf-gallery-attachments").prepend(a)}}},clear_selection:function(){this.get_attachment().removeClass("active")},select:function(e){if(!e.hasClass("active")){var t=e.attr("data-id");this.clear_selection(),e.addClass("active"),this.fetch(t),this.open_sidebar()}},open_sidebar:function(){this.$el.addClass("sidebar-open"),this.$el.find(".bulk-actions").hide(),this.$el.find(".acf-gallery-main").animate({right:350},250),this.$el.find(".acf-gallery-side").animate({width:349},250)},close_sidebar:function(){this.$el.removeClass("sidebar-open");var t=this.$el.find(".bulk-actions");this.clear_selection(),this.$el.find(".acf-gallery-side").find("input, textarea, select").attr("disabled","disabled"),this.$el.find(".acf-gallery-main").animate({right:0},250),this.$el.find(".acf-gallery-side").animate({width:0},250,function(){t.show(),e(this).find(".acf-gallery-side-data").html("")})},fetch:function(t){var a=acf.prepare_for_ajax({action:"acf/fields/gallery/get_attachment",field_key:acf.get_data(this.$field,"key"),nonce:acf.get("nonce"),post_id:acf.get("post_id"),id:t});this.$el.data("xhr")&&this.$el.data("xhr").abort();var i=e.ajax({url:acf.get("ajaxurl"),dataType:"html",type:"get",cache:!1,data:a,context:this,success:this.render_fetch});this.$el.data("xhr",i)},render_fetch:function(e){if(e){var t=this.$el.find(".acf-gallery-side-data");t.html(e),t.find(".compat-field-acf-form-data").remove();var a=t.find("> .compat-attachment-fields > tbody > tr").detach();t.find("> table.form-table > tbody").append(a),t.find("> .compat-attachment-fields").remove(),acf.do_action("append",t)}},save:function(){var t=this.$el.find(".update-attachment");return $form=this.$el.find(".acf-gallery-side-data"),data=acf.serialize_form($form),t.attr("disabled")?!1:(t.attr("disabled","disabled"),t.before('<i class="acf-loading"></i>'),data.action="acf/fields/gallery/update_attachment",acf.prepare_for_ajax(data),void e.ajax({url:acf.get("ajaxurl"),data:data,type:"post",dataType:"json",complete:function(e){t.removeAttr("disabled"),t.prev(".acf-loading").remove()}}))},add:function(e){if(this.o.max>0&&this.count()>=this.o.max)return void acf.validation.add_warning(this.$field,acf._e("gallery","max"));e.name=this.$el.find('[data-name="ids"]').attr("name");var t=acf._e("gallery","tmpl"),a=_.template(t,e);this.$el.find(".acf-gallery-attachments").append(a),this.render()},remove:function(e){this.clear_selection(),this.close_sidebar(),this.get_attachment(e).remove(),this.render()},render_collection:function(e){var t=this;setTimeout(function(){var a=e.content.get().$el;if(collection=e.content.get().collection||null){var i=-1;collection.each(function(e){i++;var l=a.find(".attachments > .attachment:eq("+i+")");t.get_attachment(e.id).exists()&&(e.off("selection:single"),l.addClass("acf-selected"))})}},10)},popup:function(){if(this.o.max>0&&this.count()>=this.o.max)return void acf.validation.add_warning(this.$field,acf._e("gallery","max"));var e=this.o.library,t=this.o.preview_size,a=this,i=acf.media.popup({title:acf._e("gallery","select"),mode:"select",type:"all",multiple:"add",library:e,select:function(e,i){if(!a.get_attachment(e.id).exists()){var l={id:e.id,url:e.attributes.url};"image"!=e.attributes.type&&(l.url=e.attributes.icon),acf.isset(e,"attributes","sizes",t)&&(l.url=e.attributes.sizes[t].url),a.add(l)}}});i.on("content:activate:browse",function(){a.render_collection(i),i.content.get().collection.on("reset add",function(){a.render_collection(i)})})},resize:function(){for(var e=100,t=175,a=4,i=this.$el.width(),l=0;10>l;l++){var n=i/l;if(n>e&&t>n){a=l;break}}this.$el.attr("data-columns",a)}},acf.add_action("ready append",function(t){acf.get_fields({type:"gallery"},t).each(function(){acf.fields.gallery.set(e(this)).init()})}),acf.add_action("submit",function(t){acf.get_fields({type:"gallery"},t).each(function(){acf.fields.gallery.set(e(this)).close_sidebar()})}),e(window).on("resize",function(){acf.get_fields({type:"gallery"}).each(function(){acf.fields.gallery.set(e(this)).resize()})}),e(document).on("click",".acf-gallery .acf-gallery-attachment",function(t){acf.fields.gallery.focus(e(this)).select(e(this))}),e(document).on("click",".acf-gallery .close-sidebar",function(t){acf.fields.gallery.focus(e(this)).close_sidebar()}),e(document).on("change",".acf-gallery-side input, .acf-gallery-side textarea, .acf-gallery-side select",function(t){e(this).closest(".acf-gallery-side").find(".update-attachment").trigger("click")}),e(document).on("click",".acf-gallery .update-attachment",function(t){acf.fields.gallery.focus(e(this)).save()}),e(document).on("click",".acf-gallery .remove-attachment",function(t){return acf.fields.gallery.focus(e(this)).remove(e(this).attr("data-id")),!1}),e(document).on("click",".acf-gallery .add-attachment",function(t){acf.fields.gallery.focus(e(this)).popup()}),e(document).on("change",".acf-gallery .bulk-actions",function(t){acf.fields.gallery.focus(e(this)).sort(e(this).val()),e(this).val("")}),e(document).on("click",".acf-gallery .edit-attachment",function(t){var a=e(this).attr("data-id"),i=acf.media.popup({title:acf._e("image","edit"),button:acf._e("image","update"),mode:"edit",id:a,select:function(){acf.fields.gallery.fetch(a)}})})}(jQuery);
